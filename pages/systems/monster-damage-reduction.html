<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Monster Damage Reduction &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/nav-loader.js" defer></script>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content">
        <header class="content-header">
          <h1 class="content-title">Monster Damage Reduction</h1>
          <p class="content-tagline">
            Calculator for monster damage reduction by level gap (max 30%).
          </p>
        </header>

        <article class="content-section">
          <h2>Key Points</h2>
          <ul>
            <li>If monster level is at or below player level: 0% reduction (full damage).</li>
            <li>Reduction scales linearly between each band&rsquo;s start and cap thresholds.</li>
            <li>Higher-level players have higher start thresholds before reduction begins.</li>
            <li>Max reduction is 30%; damage received = 100% - reduction.</li>
          </ul>

          <section>
            <h2>Level Bands</h2>
            <div class="stat-grid" role="list" aria-label="Monster damage reduction level bands">
              <section class="stat-card" role="listitem">
                <p class="stat-label">Levels 0&ndash;25</p>
                <h3>Starts at +10 levels</h3>
                <p>Ramps from +10 to +20 level difference up to <strong>30%</strong> reduction.</p>
              </section>
              <section class="stat-card" role="listitem">
                <p class="stat-label">Levels 26&ndash;50</p>
                <h3>Starts at +20 levels</h3>
                <p>Ramps from +20 to +30 level difference up to <strong>30%</strong> reduction.</p>
              </section>
              <section class="stat-card" role="listitem">
                <p class="stat-label">Levels 51+</p>
                <h3>Starts at +30 levels</h3>
                <p>Ramps from +30 to +40 level difference up to <strong>30%</strong> reduction.</p>
              </section>
            </div>
          </section>

          <section>
            <h2>Calculator</h2>
            <p>Adjust levels; monster slider moves in 5-level steps.</p>
            <div class="stat-widget" data-monster-dr-widget>
              <div class="stat-control">
                <label for="player-level">Player Level &mdash; <span data-player-value>25</span></label>
                <input
                  type="range"
                  id="player-level"
                  min="0"
                  max="120"
                  value="25"
                  step="1"
                  data-player-input
                />
              </div>
              <div class="stat-control">
                <label for="monster-level">Monster Level &mdash; <span data-monster-value>45</span></label>
                <input
                  type="range"
                  id="monster-level"
                  min="0"
                  max="160"
                  value="45"
                  step="5"
                  data-monster-input
                />
              </div>
              <div class="stat-grid" aria-label="Monster damage reduction results">
                <section class="stat-card">
                  <p class="stat-label">Level Difference</p>
                  <h3 data-level-gap>+20</h3>
                  <p data-band-note>Scaling band: 0-25 (start +10, cap +20)</p>
                </section>
                <section class="stat-card">
                  <p class="stat-label">Damage Reduction</p>
                  <h3 data-reduction-value>30%</h3>
                  <p>Percent cut to incoming monster damage.</p>
                </section>
                <section class="stat-card">
                  <p class="stat-label">Damage Received</p>
                  <h3 data-received-value>70%</h3>
                  <p>What lands after reduction.</p>
                </section>
              </div>
              <p class="calculator-note" data-result-note>
                At +20, this band is capped at 30% reduction.
              </p>
            </div>
          </section>
        </article>
      </main>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const widget = document.querySelector("[data-monster-dr-widget]");
        if (!widget) return;

        const playerInput = widget.querySelector("[data-player-input]");
        const monsterInput = widget.querySelector("[data-monster-input]");
        const playerValue = widget.querySelector("[data-player-value]");
        const monsterValue = widget.querySelector("[data-monster-value]");
        const gapValue = widget.querySelector("[data-level-gap]");
        const bandNote = widget.querySelector("[data-band-note]");
        const reductionValue = widget.querySelector("[data-reduction-value]");
        const receivedValue = widget.querySelector("[data-received-value]");
        const resultNote = widget.querySelector("[data-result-note]");

        const maxReduction = 30;
        const bands = [
          { min: 0, max: 25, start: 10, cap: 20 },
          { min: 26, max: 50, start: 20, cap: 30 },
          { min: 51, max: Infinity, start: 30, cap: 40 }
        ];

        const formatPercent = (value) => `${Math.round(value)}%`;
        const formatGap = (gap) => (gap === 0 ? "Even level" : `${gap > 0 ? "+" : ""}${gap}`);

        function getBand(level) {
          return bands.find((band) => level >= band.min && level <= band.max) || bands[bands.length - 1];
        }

        function calculateReduction(playerLevel, monsterLevel) {
          const levelGap = monsterLevel - playerLevel;
          const band = getBand(playerLevel);
          const bandLabel =
            band.max === Infinity
              ? `${band.min}+ (start +${band.start}, cap +${band.cap})`
              : `${band.min}-${band.max} (start +${band.start}, cap +${band.cap})`;

          if (levelGap <= 0) {
            return {
              reduction: 0,
              bandLabel,
              note: "Monster level is equal or lower; reduction is 0%.",
              gap: levelGap
            };
          }

          if (levelGap <= band.start) {
            return {
              reduction: 0,
              bandLabel,
              note: `Reduction starts at +${band.start} for this band.`,
              gap: levelGap
            };
          }

          const scalingWindow = band.cap - band.start;
          const gapIntoWindow = Math.min(levelGap, band.cap) - band.start;
          const reduction = Math.min(maxReduction, (gapIntoWindow / scalingWindow) * maxReduction);

          const capped = levelGap >= band.cap;
          const note = capped
            ? `Gap is +${band.cap} or higher; reduction is capped at ${maxReduction}%.`
            : `Gap is +${levelGap}; ${gapIntoWindow} levels into this band's scaling window.`;

          return { reduction, bandLabel, note, gap: levelGap };
        }

        function update() {
          const playerLevel = Number(playerInput.value);
          const monsterLevel = Number(monsterInput.value);
          const { reduction, bandLabel, note, gap } = calculateReduction(playerLevel, monsterLevel);
          const damageReceived = Math.max(0, 100 - reduction);

          playerValue.textContent = playerLevel;
          monsterValue.textContent = monsterLevel;
          gapValue.textContent = formatGap(gap);
          bandNote.textContent = `Scaling band: ${bandLabel}`;
          reductionValue.textContent = formatPercent(reduction);
          receivedValue.textContent = formatPercent(damageReceived);
          resultNote.textContent = note;
        }

        playerInput.addEventListener("input", update);
        monsterInput.addEventListener("input", update);
        update();
      });
    </script>
  </body>
</html>
