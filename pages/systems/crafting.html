<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Crafting System &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/site-search.js" defer></script>
    <script src="js/weapon-specialty.js" defer></script>
    <script src="js/stat-widgets.js" defer></script>
    <script src="js/keyword-links.js" defer></script>
    <script src="js/cursor-toggle.js" defer></script>
    <script src="js/perks.js" defer></script>
    <script src="js/rarity-roller.js" defer></script>
    <script src="js/nav-core.js" defer></script>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content">
        <header class="content-header">
          <h1 class="content-title">Crafting System</h1>
          <p class="content-tagline">
            Craft Frost and Dragon armor with Ice Crystals and Dragon Scales.
          </p>
        </header>

        <article class="content-section">
          <h2>Currency &amp; Requirements</h2>
          <p>
            Crafting revolves around two specialty drops: <strong>Ice Crystals</strong> for Frost armor and
            <strong>Dragon Scales</strong> for Dragon armor. Scales come in four colors&mdash;<strong>Black</strong>,
            <strong>Red</strong>, <strong>Blue</strong>, and <strong>Green</strong>&mdash;and the color you feed the anvil
            determines the look of the finished Dragon piece. Ice Crystals have only one variant, so their entire supply
            goes toward Frost gear.
          </p>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Tools</p>
              <h3>Hammer & Anvil</h3>
              <p>Carry a blacksmith hammer and use an anvil.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Input</p>
              <h3>Spend Stack</h3>
              <p>Stand adjacent to the anvil, right-click the hammer, then select the crystal or scale stack to open the piece selector.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Recipes</p>
              <h3>Armor Only</h3>
              <p>Only Frost and Dragon armor slots exist; all materials go to those sets.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Success</p>
              <h3>100% Rate</h3>
              <p>Crafting succeeds at 100%; no materials are lost.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Cost</p>
              <h3>Full Suit</h3>
              <p>455 Ice Crystals or 455 Dragon Scales for a complete armor set.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Outcome</p>
              <h3>Rarity Roll</h3>
              <p>The finished piece appears after ~4 seconds and rolls a random rarity.</p>
            </section>
          </div>
        </article>

        <article class="content-section">
          <h2>Material Costs</h2>
          <p>
            Each slot uses the same recipe whether you are building Frost armor (Ice Crystals) or any Dragon color (Dragon
            Scales). Pick the slot you need, pay the cost in the matching resource type, and the piece appears after a short
            (~4 second) channel.
          </p>
          <div class="stat-grid">
            <section class="stat-card">
              <h3>Helm</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Helmet.png"
                alt="Frost Helmet"
                loading="lazy"
                data-slot-preview
                data-slot="helm"
              />
              <p><strong>30</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Gauntlets</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Gauntlets.png"
                alt="Frost Gauntlets"
                loading="lazy"
                data-slot-preview
                data-slot="gauntlets"
              />
              <p><strong>55</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Legs</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Leggings.png"
                alt="Frost Leggings"
                loading="lazy"
                data-slot-preview
                data-slot="legs"
              />
              <p><strong>99</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Shield</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Shield.png"
                alt="Frost Shield"
                loading="lazy"
                data-slot-preview
                data-slot="shield"
              />
              <p><strong>113</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Plate</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Platemail.png"
                alt="Frost Platemail"
                loading="lazy"
                data-slot-preview
                data-slot="plate"
              />
              <p><strong>158</strong> Ice Crystals or Dragon Scales.</p>
            </section>
          </div>
        </article>

        <article class="content-section">
          <h2>Materials Calculator</h2>
          <p>
            Use this quick planner to see whether your current stockpile can cover the pieces you want. Toggle any slot
            to include it in the plan, then adjust your material count to find gaps or leftovers.
          </p>
          <div class="stat-widget">
            <div class="stat-control">
              <label for="materials-slider">Current Materials: <span data-materials-value>0</span></label>
              <input type="range" id="materials-slider" min="0" max="1000" value="0" step="1" data-materials-range />
            </div>
          <div class="calculator-grid" data-material-options>
            <div class="calc-chip" data-slot="helm" data-cost="30" role="button" tabindex="0">
              <h4>Helm</h4>
              <span>30 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Helm count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Helm count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="gauntlets" data-cost="55" role="button" tabindex="0">
              <h4>Gauntlets</h4>
              <span>55 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Gauntlets count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Gauntlets count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="legs" data-cost="99" role="button" tabindex="0">
              <h4>Legs</h4>
              <span>99 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Legs count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Legs count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="shield" data-cost="113" role="button" tabindex="0">
              <h4>Shield</h4>
              <span>113 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Shield count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Shield count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="plate" data-cost="158" role="button" tabindex="0">
              <h4>Plate</h4>
              <span>158 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Plate count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Plate count">+</button>
              </div>
            </div>
          </div>
            <div class="materials-summary" data-material-summary>
              Select at least one slot to see totals.
            </div>
          </div>
        </article>
      </main>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const slotPreviews = document.querySelectorAll("[data-slot-preview]");
        const slotNames = {
          helm: "Helm",
          gauntlets: "Gauntlets",
          legs: "Leggings",
          shield: "Shield",
          plate: "Plate"
        };
        const frostSet = {
          label: "Frost",
          helm: "images/armors/Frost%20Helmet.png",
          gauntlets: "images/armors/Frost%20Gauntlets.png",
          legs: "images/armors/Frost%20Leggings.png",
          shield: "images/armors/Frost%20Shield.png",
          plate: "images/armors/Frost%20Platemail.png"
        };

        if (slotPreviews.length) {
          slotPreviews.forEach((img) => {
            const slot = img.dataset.slot;
            const asset = frostSet[slot];
            if (asset) {
              img.src = asset;
              img.alt = `${frostSet.label} ${slotNames[slot] || "Armor"}`;
            }
          });
        }

        const slider = document.querySelector("[data-materials-range]");
        const valueLabel = document.querySelector("[data-materials-value]");
        const chips = Array.from(document.querySelectorAll("[data-material-options] .calc-chip"));
        const summary = document.querySelector("[data-material-summary]");

        if (!slider || !valueLabel || chips.length === 0 || !summary) {
          return;
        }

        const slotLabels = {
          helm: { singular: "Helm", plural: "Helms" },
          gauntlets: { singular: "Gauntlets", plural: "Gauntlets" },
          legs: { singular: "Legs", plural: "Legs" },
          shield: { singular: "Shield", plural: "Shields" },
          plate: { singular: "Plate", plural: "Plates" }
        };

        const state = {
          currentMats: Number(slider.value),
          slotCounts: chips.reduce((acc, chip) => {
            acc[chip.dataset.slot] = 0;
            return acc;
          }, {})
        };

        function formatNumber(num) {
          return num.toLocaleString();
        }

        function pluralize(count, singular, plural) {
          return count === 1 ? singular : plural || `${singular}s`;
        }

        function describeSelection() {
          const items = Object.entries(state.slotCounts)
            .filter(([, count]) => count > 0)
            .map(([slot, count]) => {
              const { singular, plural } = slotLabels[slot] || { singular: slotNames[slot] || slot, plural: `${slotNames[slot] || slot}s` };
              const label = count === 1 ? singular : plural;
              return `${count} ${label}`;
            });

          if (items.length === 0) {
            return "";
          }
          if (items.length === 1) {
            return items[0];
          }
          if (items.length === 2) {
            return `${items[0]} and ${items[1]}`;
          }
          const last = items.pop();
          return `${items.join(", ")}, and ${last}`;
        }

        function updateSummary() {
          const selectedChips = chips.filter((chip) => state.slotCounts[chip.dataset.slot] > 0);
          const totalCost = selectedChips.reduce(
            (sum, chip) => sum + Number(chip.dataset.cost) * state.slotCounts[chip.dataset.slot],
            0
          );

          if (selectedChips.length === 0) {
            summary.textContent = "Select at least one slot to see totals.";
            return;
          }

          const selectionLabel = describeSelection();
          const diff = state.currentMats - totalCost;
          const remainingLabel = pluralize(Math.abs(diff), "material");
          const materialLabel = pluralize(Math.abs(diff), "material");

          if (diff >= 0) {
            summary.textContent = `You have enough materials to craft ${selectionLabel}. ${formatNumber(diff)} ${remainingLabel} remain.`;
          } else {
            summary.textContent = `Need ${formatNumber(Math.abs(diff))} more ${materialLabel} to craft ${selectionLabel}.`;
          }
        }

        function setChipActive(chip, isActive) {
          chip.dataset.active = isActive ? "true" : "false";
        }

        function updateChipCount(chip) {
          const countEl = chip.querySelector("[data-qty-count]");
          if (countEl) {
            countEl.textContent = state.slotCounts[chip.dataset.slot];
          }
        }

        function adjustSlotCount(slot, newValue) {
          const chip = chips.find((c) => c.dataset.slot === slot);
          if (!chip) {
            return;
          }

          if (newValue <= 0) {
            state.slotCounts[slot] = 0;
            setChipActive(chip, false);
          } else {
            state.slotCounts[slot] = newValue;
            setChipActive(chip, true);
          }
          updateChipCount(chip);
          updateSummary();
        }

        function toggleChip(chip) {
          const slot = chip.dataset.slot;
          if (state.slotCounts[slot] > 0) {
            adjustSlotCount(slot, 0);
          } else {
            adjustSlotCount(slot, 1);
          }
        }

        slider.addEventListener("input", () => {
          state.currentMats = Number(slider.value);
          valueLabel.textContent = formatNumber(state.currentMats);
          updateSummary();
        });

        chips.forEach((chip) => {
          chip.dataset.active = "false";
          chip.addEventListener("click", (event) => {
            if (event.target.closest(".calc-qty-control")) {
              return;
            }
            toggleChip(chip);
          });
          chip.addEventListener("keydown", (event) => {
            if (event.key === "Enter" || event.key === " ") {
              event.preventDefault();
              toggleChip(chip);
            }
          });

          const minusBtn = chip.querySelector("[data-qty-minus]");
          const plusBtn = chip.querySelector("[data-qty-plus]");
          const slot = chip.dataset.slot;

          if (minusBtn) {
            minusBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              if (state.slotCounts[slot] > 1) {
                adjustSlotCount(slot, state.slotCounts[slot] - 1);
              }
            });
          }

          if (plusBtn) {
            plusBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              const current = state.slotCounts[slot];
              adjustSlotCount(slot, current > 0 ? current + 1 : 1);
            });
          }
        });

        valueLabel.textContent = formatNumber(state.currentMats);
        updateSummary();
      });
    </script>
    <script>
      (() => {
        const manifestMap = new Map();
        const resolveArmorImage = (name) => {
          const trimmed = (name || "").trim();
          const lower = trimmed.toLowerCase();
          if (lower && manifestMap.has(lower)) return encodeURI(manifestMap.get(lower));
          if (!trimmed) return "";
          const encoded = encodeURIComponent(trimmed);
          return `images/armors/${encoded}.gif`;
        };

        fetch("images/armors/manifest.json")
          .then((res) => (res.ok ? res.json() : Promise.reject()))
          .then((list) => {
            const entries = Array.isArray(list) ? list : [];
            entries.forEach((path) => {
              const file = String(path || "").split(/[\\/]/).pop() || "";
              const base = file.replace(/\.[^.]+$/, "").toLowerCase();
              if (base) {
                const normalizedPath = String(path || "").replace(/^\\.\\//, "").replace(/\\/g, "/");
                manifestMap.set(base, normalizedPath);
              }
            });
          })
          .catch(() => {})
          .finally(() => {
            document.querySelectorAll("img[data-armor-name]").forEach((img) => {
              const name = img.getAttribute("data-armor-name");
              const src = resolveArmorImage(name);
              if (src) {
                img.src = encodeURI(src);
              } else {
                img.alt = (img.alt || "Armor image") + " (missing)";
              }
            });
          });
      })();
    </script>
  </body>
</html>
