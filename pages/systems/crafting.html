<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Crafting System &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/nav-loader.js" defer></script>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content">
        <header class="content-header">
          <h1 class="content-title">Crafting System</h1>
          <p class="content-tagline">
            How Dragon Scales and Ice Crystals become elite Frost and Dragon armor in Project Rogue.
          </p>
        </header>

        <article class="content-section">
          <h2>Currency &amp; Requirements</h2>
          <p>
            Crafting revolves around two specialty drops: <strong>Ice Crystals</strong> for Frost armor and
            <strong>Dragon Scales</strong> for Dragon armor. Scales come in four colors&mdash;<strong>Black</strong>,
            <strong>Red</strong>, <strong>Blue</strong>, and <strong>Green</strong>&mdash;and the color you feed the anvil
            determines the look of the finished Dragon piece. Ice Crystals have only one variant, so their entire supply
            goes toward Frost gear.
          </p>
          <ul>
            <li>Carry a <strong>blacksmith hammer</strong> (buyable from town blacksmith NPCs) and stand beside an <strong>anvil</strong>.</li>
            <li>
              Stand on a tile adjacent to the anvil, right-click the hammer in your inventory, then click the crystal or
              scale stack you want to spend to open the piece selector.
            </li>
            <li>Crafting has a <strong>100% success rate</strong>; no mats are lost to RNG.</li>
            <li>The only recipes are Frost and Dragon armor slots, so every resource funnels into those sets.</li>
            <li>A full armor suit consumes <strong>455</strong> Ice Crystals (Frost) or <strong>455</strong> Dragon Scales (any color).</li>
            <li>When the craft finishes (~4 seconds), the new piece rolls a random rarity.</li>
          </ul>
          <section class="armor-set" aria-label="Frost armor set">
            <h3>Frost Set</h3>
            <div class="armor-gallery">
              <figure>
                <img src="images/armors/Frost%20Helmet.png" alt="Frost Helmet" loading="lazy" />
                <figcaption>Helm</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Frost%20Gauntlets.png" alt="Frost Gauntlets" loading="lazy" />
                <figcaption>Gauntlets</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Frost%20Leggings.png" alt="Frost Leggings" loading="lazy" />
                <figcaption>Legs</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Frost%20Shield.png" alt="Frost Shield" loading="lazy" />
                <figcaption>Shield</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Frost%20Platemail.png" alt="Frost Plate" loading="lazy" />
                <figcaption>Plate</figcaption>
              </figure>
            </div>
          </section>
          <section class="armor-set" aria-label="Black Dragon armor set">
            <h3>Black Dragon Set</h3>
            <div class="armor-gallery">
              <figure>
                <img src="images/armors/Black%20Dragon%20Helmet.gif" alt="Black Dragon Helmet" loading="lazy" />
                <figcaption>Helm</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Black%20Dragon%20Gauntlets.png" alt="Black Dragon Gauntlets" loading="lazy" />
                <figcaption>Gauntlets</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Black%20Dragon%20Leggings.png" alt="Black Dragon Leggings" loading="lazy" />
                <figcaption>Legs</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Black%20Dragon%20Shield.png" alt="Black Dragon Shield" loading="lazy" />
                <figcaption>Shield</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Black%20Dragon%20Platemail.png" alt="Black Dragon Plate" loading="lazy" />
                <figcaption>Plate</figcaption>
              </figure>
            </div>
          </section>
          <section class="armor-set" aria-label="Red Dragon armor set">
            <h3>Red Dragon Set</h3>
            <div class="armor-gallery">
              <figure>
                <img src="images/armors/Red%20Dragon%20Helmet.png" alt="Red Dragon Helmet" loading="lazy" />
                <figcaption>Helm</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Red%20Dragon%20Gauntlets.png" alt="Red Dragon Gauntlets" loading="lazy" />
                <figcaption>Gauntlets</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Red%20Dragon%20Leggings.png" alt="Red Dragon Leggings" loading="lazy" />
                <figcaption>Legs</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Red%20Dragon%20Shield.png" alt="Red Dragon Shield" loading="lazy" />
                <figcaption>Shield</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Red%20Dragon%20Platemail.gif" alt="Red Dragon Plate" loading="lazy" />
                <figcaption>Plate</figcaption>
              </figure>
            </div>
          </section>
          <section class="armor-set" aria-label="Blue Dragon armor set">
            <h3>Blue Dragon Set</h3>
            <div class="armor-gallery">
              <figure>
                <img src="images/armors/Blue%20Dragon%20Helmet.png" alt="Blue Dragon Helmet" loading="lazy" />
                <figcaption>Helm</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Blue%20Dragon%20Gauntlets.png" alt="Blue Dragon Gauntlets" loading="lazy" />
                <figcaption>Gauntlets</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Blue%20Dragon%20Leggings.png" alt="Blue Dragon Leggings" loading="lazy" />
                <figcaption>Legs</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Blue%20Dragon%20Shield.png" alt="Blue Dragon Shield" loading="lazy" />
                <figcaption>Shield</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Blue%20Dragon%20Platemail.png" alt="Blue Dragon Plate" loading="lazy" />
                <figcaption>Plate</figcaption>
              </figure>
            </div>
          </section>
          <section class="armor-set" aria-label="Green Dragon armor set">
            <h3>Green Dragon Set</h3>
            <div class="armor-gallery">
              <figure>
                <img src="images/armors/Green%20Dragon%20Helmet.gif" alt="Green Dragon Helmet" loading="lazy" />
                <figcaption>Helm</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Green%20Dragon%20Gauntlets.png" alt="Green Dragon Gauntlets" loading="lazy" />
                <figcaption>Gauntlets</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Green%20Dragon%20Leggings.png" alt="Green Dragon Leggings" loading="lazy" />
                <figcaption>Legs</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Green%20Dragon%20Shield.png" alt="Green Dragon Shield" loading="lazy" />
                <figcaption>Shield</figcaption>
              </figure>
              <figure>
                <img src="images/armors/Green%20Dragon%20Platemail.png" alt="Green Dragon Plate" loading="lazy" />
                <figcaption>Plate</figcaption>
              </figure>
            </div>
          </section>
        </article>

        <article class="content-section">
          <h2>Material Costs</h2>
          <p>
            Each slot uses the same recipe whether you are building Frost armor (Ice Crystals) or any Dragon color (Dragon
            Scales). Pick the slot you need, pay the cost in the matching resource type, and the piece appears after a short
            (~4 second) channel.
          </p>
          <p class="text-muted">
            Slot previews below show: <span data-slot-set-label>Frost Set</span>
          </p>
          <div class="stat-grid">
            <section class="stat-card">
              <h3>Helm</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Helmet.png"
                alt="Frost Helmet"
                loading="lazy"
                data-slot-preview
                data-slot="helm"
              />
              <p><strong>30</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Gauntlets</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Gauntlets.png"
                alt="Frost Gauntlets"
                loading="lazy"
                data-slot-preview
                data-slot="gauntlets"
              />
              <p><strong>55</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Legs</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Leggings.png"
                alt="Frost Leggings"
                loading="lazy"
                data-slot-preview
                data-slot="legs"
              />
              <p><strong>99</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Shield</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Shield.png"
                alt="Frost Shield"
                loading="lazy"
                data-slot-preview
                data-slot="shield"
              />
              <p><strong>113</strong> Ice Crystals or Dragon Scales.</p>
            </section>
            <section class="stat-card">
              <h3>Plate</h3>
              <img
                class="armor-slot-preview"
                src="images/armors/Frost%20Platemail.png"
                alt="Frost Platemail"
                loading="lazy"
                data-slot-preview
                data-slot="plate"
              />
              <p><strong>158</strong> Ice Crystals or Dragon Scales.</p>
            </section>
          </div>
        </article>

        <article class="content-section">
          <h2>Materials Calculator</h2>
          <p>
            Use this quick planner to see whether your current stockpile can cover the pieces you want. Toggle any slot
            to include it in the plan, then adjust your material count to find gaps or leftovers.
          </p>
          <div class="stat-widget">
            <div class="stat-control">
              <label for="materials-slider">Current Materials: <span data-materials-value>0</span></label>
              <input type="range" id="materials-slider" min="0" max="1000" value="0" step="1" data-materials-range />
            </div>
          <div class="calculator-grid" data-material-options>
            <div class="calc-chip" data-slot="helm" data-cost="30" role="button" tabindex="0">
              <h4>Helm</h4>
              <span>30 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Helm count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Helm count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="gauntlets" data-cost="55" role="button" tabindex="0">
              <h4>Gauntlets</h4>
              <span>55 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Gauntlets count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Gauntlets count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="legs" data-cost="99" role="button" tabindex="0">
              <h4>Legs</h4>
              <span>99 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Legs count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Legs count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="shield" data-cost="113" role="button" tabindex="0">
              <h4>Shield</h4>
              <span>113 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Shield count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Shield count">+</button>
              </div>
            </div>
            <div class="calc-chip" data-slot="plate" data-cost="158" role="button" tabindex="0">
              <h4>Plate</h4>
              <span>158 mats</span>
              <div class="calc-qty-control">
                <button type="button" class="qty-btn" data-qty-minus aria-label="Decrease Plate count">−</button>
                <span data-qty-count>0</span>
                <button type="button" class="qty-btn" data-qty-plus aria-label="Increase Plate count">+</button>
              </div>
            </div>
          </div>
            <div class="materials-summary" data-material-summary>
              Select at least one slot to see totals.
            </div>
          </div>
        </article>
      </main>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const slotPreviews = document.querySelectorAll("[data-slot-preview]");
        const slotSetLabel = document.querySelector("[data-slot-set-label]");
        const slotNames = {
          helm: "Helm",
          gauntlets: "Gauntlets",
          legs: "Leggings",
          shield: "Shield",
          plate: "Plate"
        };
        const armorSets = {
          frost: {
            label: "Frost",
            helm: "images/armors/Frost%20Helmet.png",
            gauntlets: "images/armors/Frost%20Gauntlets.png",
            legs: "images/armors/Frost%20Leggings.png",
            shield: "images/armors/Frost%20Shield.png",
            plate: "images/armors/Frost%20Platemail.png"
          },
          black: {
            label: "Black Dragon",
            helm: "images/armors/Black%20Dragon%20Helmet.gif",
            gauntlets: "images/armors/Black%20Dragon%20Gauntlets.png",
            legs: "images/armors/Black%20Dragon%20Leggings.png",
            shield: "images/armors/Black%20Dragon%20Shield.png",
            plate: "images/armors/Black%20Dragon%20Platemail.png"
          },
          red: {
            label: "Red Dragon",
            helm: "images/armors/Red%20Dragon%20Helmet.png",
            gauntlets: "images/armors/Red%20Dragon%20Gauntlets.png",
            legs: "images/armors/Red%20Dragon%20Leggings.png",
            shield: "images/armors/Red%20Dragon%20Shield.png",
            plate: "images/armors/Red%20Dragon%20Platemail.gif"
          },
          blue: {
            label: "Blue Dragon",
            helm: "images/armors/Blue%20Dragon%20Helmet.png",
            gauntlets: "images/armors/Blue%20Dragon%20Gauntlets.png",
            legs: "images/armors/Blue%20Dragon%20Leggings.png",
            shield: "images/armors/Blue%20Dragon%20Shield.png",
            plate: "images/armors/Blue%20Dragon%20Platemail.png"
          },
          green: {
            label: "Green Dragon",
            helm: "images/armors/Green%20Dragon%20Helmet.gif",
            gauntlets: "images/armors/Green%20Dragon%20Gauntlets.png",
            legs: "images/armors/Green%20Dragon%20Leggings.png",
            shield: "images/armors/Green%20Dragon%20Shield.png",
            plate: "images/armors/Green%20Dragon%20Platemail.png"
          }
        };

        if (slotPreviews.length) {
          const setKeys = Object.keys(armorSets);
          const randomKey = setKeys[Math.floor(Math.random() * setKeys.length)];
          const selectedSet = armorSets[randomKey];

          slotPreviews.forEach((img) => {
            const slot = img.dataset.slot;
            const asset = selectedSet[slot];
            if (asset) {
              img.src = asset;
              img.alt = `${selectedSet.label} ${slotNames[slot] || "Armor"}`;
            }
          });

          if (slotSetLabel) {
            slotSetLabel.textContent = `${selectedSet.label} Set`;
          }
        }

        const slider = document.querySelector("[data-materials-range]");
        const valueLabel = document.querySelector("[data-materials-value]");
        const chips = Array.from(document.querySelectorAll("[data-material-options] .calc-chip"));
        const summary = document.querySelector("[data-material-summary]");

        if (!slider || !valueLabel || chips.length === 0 || !summary) {
          return;
        }

        const slotLabels = {
          helm: { singular: "Helm", plural: "Helms" },
          gauntlets: { singular: "Gauntlets", plural: "Gauntlets" },
          legs: { singular: "Legs", plural: "Legs" },
          shield: { singular: "Shield", plural: "Shields" },
          plate: { singular: "Plate", plural: "Plates" }
        };

        const state = {
          currentMats: Number(slider.value),
          slotCounts: chips.reduce((acc, chip) => {
            acc[chip.dataset.slot] = 0;
            return acc;
          }, {})
        };

        function formatNumber(num) {
          return num.toLocaleString();
        }

        function pluralize(count, singular, plural) {
          return count === 1 ? singular : plural || `${singular}s`;
        }

        function describeSelection() {
          const items = Object.entries(state.slotCounts)
            .filter(([, count]) => count > 0)
            .map(([slot, count]) => {
              const { singular, plural } = slotLabels[slot] || { singular: slotNames[slot] || slot, plural: `${slotNames[slot] || slot}s` };
              const label = count === 1 ? singular : plural;
              return `${count} ${label}`;
            });

          if (items.length === 0) {
            return "";
          }
          if (items.length === 1) {
            return items[0];
          }
          if (items.length === 2) {
            return `${items[0]} and ${items[1]}`;
          }
          const last = items.pop();
          return `${items.join(", ")}, and ${last}`;
        }

        function updateSummary() {
          const selectedChips = chips.filter((chip) => state.slotCounts[chip.dataset.slot] > 0);
          const totalCost = selectedChips.reduce(
            (sum, chip) => sum + Number(chip.dataset.cost) * state.slotCounts[chip.dataset.slot],
            0
          );

          if (selectedChips.length === 0) {
            summary.textContent = "Select at least one slot to see totals.";
            return;
          }

          const selectionLabel = describeSelection();
          const diff = state.currentMats - totalCost;
          const remainingLabel = pluralize(Math.abs(diff), "material");
          const materialLabel = pluralize(Math.abs(diff), "material");

          if (diff >= 0) {
            summary.textContent = `You have enough materials to craft ${selectionLabel}. ${formatNumber(diff)} ${remainingLabel} remain.`;
          } else {
            summary.textContent = `Need ${formatNumber(Math.abs(diff))} more ${materialLabel} to craft ${selectionLabel}.`;
          }
        }

        function setChipActive(chip, isActive) {
          chip.dataset.active = isActive ? "true" : "false";
        }

        function updateChipCount(chip) {
          const countEl = chip.querySelector("[data-qty-count]");
          if (countEl) {
            countEl.textContent = state.slotCounts[chip.dataset.slot];
          }
        }

        function adjustSlotCount(slot, newValue) {
          const chip = chips.find((c) => c.dataset.slot === slot);
          if (!chip) {
            return;
          }

          if (newValue <= 0) {
            state.slotCounts[slot] = 0;
            setChipActive(chip, false);
          } else {
            state.slotCounts[slot] = newValue;
            setChipActive(chip, true);
          }
          updateChipCount(chip);
          updateSummary();
        }

        function toggleChip(chip) {
          const slot = chip.dataset.slot;
          if (state.slotCounts[slot] > 0) {
            adjustSlotCount(slot, 0);
          } else {
            adjustSlotCount(slot, 1);
          }
        }

        slider.addEventListener("input", () => {
          state.currentMats = Number(slider.value);
          valueLabel.textContent = formatNumber(state.currentMats);
          updateSummary();
        });

        chips.forEach((chip) => {
          chip.dataset.active = "false";
          chip.addEventListener("click", (event) => {
            if (event.target.closest(".calc-qty-control")) {
              return;
            }
            toggleChip(chip);
          });
          chip.addEventListener("keydown", (event) => {
            if (event.key === "Enter" || event.key === " ") {
              event.preventDefault();
              toggleChip(chip);
            }
          });

          const minusBtn = chip.querySelector("[data-qty-minus]");
          const plusBtn = chip.querySelector("[data-qty-plus]");
          const slot = chip.dataset.slot;

          if (minusBtn) {
            minusBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              if (state.slotCounts[slot] > 1) {
                adjustSlotCount(slot, state.slotCounts[slot] - 1);
              }
            });
          }

          if (plusBtn) {
            plusBtn.addEventListener("click", (event) => {
              event.stopPropagation();
              const current = state.slotCounts[slot];
              adjustSlotCount(slot, current > 0 ? current + 1 : 1);
            });
          }
        });

        valueLabel.textContent = formatNumber(state.currentMats);
        updateSummary();
      });
    </script>
  </body>
</html>
