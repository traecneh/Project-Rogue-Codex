<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Encounter System &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/nav-loader.js" defer></script>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content">
        <header class="content-header">
          <h1 class="content-title">Encounter System</h1>
          <p class="content-tagline">
            How encounters paint monsters onto the world, control respawns, and escalate into Elite and Corrupted threats.
          </p>
        </header>

        <article class="content-section" id="core-rules">
          <h2>Core Rules</h2>
          <p>All open-world monster activity flows through pre-authored encounter nodes.</p>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Control</p>
              <h3>Spawn Source</h3>
              <p>All monster spawns are controlled by the <strong>Encounter System</strong>.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Layout</p>
              <h3>Chunk Painting</h3>
              <p>An <strong>Encounter</strong> is a pre-built monster layout painted chunk-by-chunk across the map.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Sets</p>
              <h3>Weighted Groups</h3>
              <p>An encounter can define up to <strong>5 weighted monster sets</strong>, each with a unique weight.</p>
              <p>Each set defines per-monster quantity ranges for minimum and maximum spawns.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Tuning</p>
              <h3>Respawn & Radius</h3>
              <p>Knobs include respawn cadence and spawn radius.</p>
            </section>
          </div>
        </article>

        <article class="content-section" id="encounter-states">
          <h2>Active vs. Passive States</h2>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Radius</p>
              <h3>Active Range</h3>
              <p>An encounter is Active when a player is within <strong>10 chunks (160 tiles)</strong> of its center.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Passive</p>
              <h3>Out of Range</h3>
              <p>If no player is in range, the encounter remains Passive.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Spawn Rate</p>
              <h3>Active Boost</h3>
              <p>While Active, most encounters increase their spawn rate.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Activation</p>
              <h3>Just Activated</h3>
              <p>Going Active after <strong>4+ minutes</strong> Passive triggers a Just Activated flag and an instant spawn pulse.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Timer</p>
              <h3>Prolonged Activity</h3>
              <p>A Prolonged Activity timer tracks continuous Active time and unlocks Elite eligibility.</p>
            </section>
          </div>
        </article>

        <article class="content-section" id="elite-system">
          <h2>Monster Spawning &amp; the Elite System</h2>
          <p>Elite escalation only begins once an encounter demonstrates sustained pressure.</p>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Flag</p>
              <h3>Prolonged Activity</h3>
              <p>After 1 minute of continuous Active time, the encounter is flagged for Prolonged Activity.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Eligibility</p>
              <h3>Elite Unlock</h3>
              <p>Flagged encounters can spawn Elite, Corrupted, and Elite+ monsters and keep that eligibility for a 6-minute grace window after going Passive.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Refresh</p>
              <h3>Grace Reset</h3>
              <p>Re-entering the 10-chunk radius during the grace period refreshes the timer.</p>
            </section>
          </div>

          <div class="stat-grid elite-grid">
            <section class="stat-card">
              <div class="stat-label">Elite</div>
              <h3>
                <span class="elite-icon-wrapper">
                  <img class="elite-random" alt="" aria-hidden="true" width="32" height="32" />
                  <img
                    src="images/elite.gif"
                    alt="Elite purple lightning effect"
                    width="32"
                    height="32"
                    class="elite-icon"
                  />
                </span>
                Purple Lightning
              </h3>
              <ul>
                <li>Spawn chance: <strong>1 in 33</strong></li>
                <li><strong>3× health</strong></li>
                <li><strong>1.5× damage</strong></li>
                <li><strong>3× drop rate</strong></li>
                <li>Base Rarity: <strong>Uncommon</strong></li>
              </ul>
            </section>
            <section class="stat-card">
              <div class="stat-label">Corrupted</div>
              <h3>
                <span class="elite-icon-wrapper">
                  <img class="elite-random" alt="" aria-hidden="true" width="32" height="32" />
                  <img
                    src="images/corrupted.gif"
                    alt="Corrupted green corruption effect"
                    width="32"
                    height="32"
                    class="elite-icon"
                  />
                </span>
                Green Lightning
              </h3>
              <ul>
                <li>Spawn chance: <strong>1 in 66</strong></li>
                <li><strong>5× health</strong></li>
                <li><strong>1.75× damage</strong></li>
                <li><strong>5× drop rate</strong></li>
                <li>Base Rarity: <strong>Uncommon</strong></li>
                <li><strong>Corrupts loot</strong></li>
              </ul>
            </section>
            <section class="stat-card">
              <div class="stat-label">Elite+</div>
              <h3>
                <span class="elite-icon-wrapper">
                  <img class="elite-random" alt="" aria-hidden="true" width="32" height="32" />
                  <img
                    src="images/elite+.gif"
                    alt="Elite+ yellow lightning effect"
                    width="32"
                    height="32"
                    class="elite-icon"
                  />
                </span>
                Yellow Lightning
              </h3>
              <ul>
                <li>Spawn chance: <strong>1 in 100</strong></li>
                <li><strong>10.0× health</strong></li>
                <li><strong>2.0× damage</strong></li>
                <li><strong>10.0× drop rate</strong></li>
                <li>Base Rarity: <strong>Rare</strong></li>
              </ul>
            </section>
          </div>
        </article>

        <article class="content-section" id="monster-despawns">
          <h2>Monster De-Spawns</h2>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Inactivity</p>
              <h3>4-Minute Rule</h3>
              <p>Monsters despawn after 4 continuous minutes without moving or attacking.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Uptime</p>
              <h3>1-Hour Cap</h3>
              <p>Any monster exceeding 1 hour of uptime despawns regardless of activity.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Exceptions</p>
              <h3>Spires</h3>
              <p>Demon Spires, Dragon Spires, and Master Spires ignore the 4-minute inactivity rule.</p>
            </section>
          </div>
        </article>

        <article class="content-section" id="boss-leashing">
          <h2>Leashing &amp; Boss Behavior</h2>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Locale</p>
              <h3>Boundaries</h3>
              <p>Bosses cannot be dragged outside the locale where they spawned.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Leash</p>
              <h3>Reset</h3>
              <p>Crossing the locale boundary forces an instant leash, resetting the encounter and restoring full health.</p>
            </section>
          </div>
        </article>
      </main>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const randomTargets = Array.from(document.querySelectorAll(".elite-random"));
        if (!randomTargets.length) return;
        fetch("images/monsters/manifest.json")
          .then((response) => {
            if (!response.ok) throw new Error("no manifest");
            return response.json();
          })
          .then((links) => {
            if (!Array.isArray(links) || !links.length) return;
            const filtered = links.filter((src) => !src.toLowerCase().includes("demon spire.gif"));
            if (!filtered.length) return;
            const bag = filtered.slice();
            randomTargets.forEach((img) => {
              if (!bag.length) {
                bag.push(...filtered);
              }
              const idx = Math.floor(Math.random() * bag.length);
              img.src = bag.splice(idx, 1)[0];
            });
          })
          .catch(() => {});
      });
    </script>
  </body>
</html>


