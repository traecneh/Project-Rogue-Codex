<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Perks System &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <style>
      .perk-index {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin: 0 0 1rem;
        padding: 0.75rem;
        border: 1px solid var(--border-soft);
        border-radius: var(--radius-md);
        background: linear-gradient(180deg, var(--bg-panel-gradient-start), var(--bg-panel-gradient-end));
      }

      .perk-index-label {
        color: var(--text-muted);
        font-size: 0.95rem;
      }

      .perk-index-select {
        min-width: min(360px, 100%);
        padding: 0.5rem 0.6rem;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-soft);
        background: var(--bg-panel-dark);
        color: var(--text-main);
      }

      .perk-index-select:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      .stat-card.perk-jump-target {
        border-color: var(--accent);
        outline: 2px solid rgba(75, 255, 75, 0.45);
        outline-offset: 3px;
        box-shadow:
          0 0 0 1px rgba(75, 255, 75, 0.12),
          0 0 18px rgba(75, 255, 75, 0.18);
      }

      @media (prefers-reduced-motion: reduce) {
        .stat-card.perk-jump-target {
          transition: none;
        }
      }
    </style>
    <script src="js/site-search.js" defer></script>
    <script src="js/weapon-specialty.js" defer></script>
    <script src="js/stat-widgets.js" defer></script>
    <script src="js/keyword-links.js" defer></script>
    <script src="js/cursor-toggle.js" defer></script>
    <script src="js/perks.js" defer></script>
    <script src="js/rarity-roller.js" defer></script>
    <script src="js/nav-core.js" defer></script>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content">
        <header class="content-header">
          <h1 class="content-title">Perks System</h1>
          <p class="content-tagline">
            Perks are item-based effects with tiered values and stacking rules.
          </p>
        </header>

        <article class="content-section">
          <h2>Overview</h2>
          <p>Perks drop on loot or come innate on items; values can change with balance updates.</p>
        </article>

        <article class="content-section" id="stacking-rules">
          <h2>Perk Stacking Rules</h2>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Limit</p>
              <h3>Three Copies</h3>
              <p>Only three copies of the same perk provide bonuses; extra copies give no benefit.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Race</p>
              <h3>Counts Toward Limit</h3>
              <p>Race bonuses count toward the three-copy limit.</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Selection</p>
              <h3>Highest Tiers</h3>
              <p>If more than three copies exist, only the three highest tiers apply.</p>
            </section>
          </div>
        </article>

        <article class="content-section" id="notation">
          <h2>Notation</h2>
          <div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Tiers</p>
              <h3>[Brackets]</h3>
              <p>Tier values list in order [T1 / T2 / T3].</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Speed</p>
              <h3>(Parentheses)</h3>
              <p>Weapon speed variants use (750 / 1000 / 1250 / 1500).</p>
            </section>

            <section class="stat-card" role="listitem">
              <p class="stat-label">Formula</p>
              <h3>{Curly Braces}</h3>
              <p>Formulas appear in curly brackets.</p>
            </section>
          </div>
        </article>

        <article class="content-section" id="perk-list">
          <h2>Perks</h2>
          <div class="perk-index" aria-label="Perk index">
            <label class="perk-index-label" for="perk-jump">Jump to perk</label>
            <select id="perk-jump" class="perk-index-select" aria-label="Jump to perk">
              <option value="">Loading perks…</option>
            </select>
          </div>
          <div class="stat-grid perk-grid">
          <section class="stat-card">
            <h3>Alchemist</h3>
            <p>Potions heal an additional <strong>[30/40/50]%</strong>, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Antitoxin</h3>
            <p><strong>[20/25/30]%</strong> chance to avoid poison, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Beastslayer</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Beasts and Animals, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Bloodlust</h3>
            <p>
              <strong>[3/4/5]%</strong> chance on attack to grant Bloodlust, increasing attack speed by
              <strong>250</strong> for <strong>12 + [0/1.5/3]</strong> seconds; chance additive.
            </p>
            <p>
              At the end of Bloodlust, you become exhausted for 1 minute and cannot trigger Bloodlust; each instance
              reduces exhaustion by <strong>[6/9/12]</strong> seconds, additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Bloodthirster</h3>
            <p>
              <strong>(21/26/31/36)%</strong> chance for attacks to heal you for
              <strong>[4/6/8]%</strong> of max health in PvP; half effectiveness in PvE.
            </p>
          </section>
          <section class="stat-card">
            <h3>Bolstered Strength</h3>
            <p>Increases max weight by <strong>[125/175/225]</strong>.</p>
          </section>
          <section class="stat-card">
            <h3>Brutality</h3>
            <p>
              <strong>(2/3/3/4)%</strong> chance on attack to grant +20% Strength for 60 seconds plus an additional
              <strong>[15/30/45]</strong> seconds; bonus duration is additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Consecration</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Undead and Disease Beasts, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Critical Aegis</h3>
            <p>
              On critical hit, gain Overshield equal to <strong>[10/12.5/15]%</strong>
              (<strong>&plusmn;20%</strong> variance) of your Dexterity. Slower weapons generate more Overshield per proc
              (up to +<strong>50%</strong> at <strong>1500ms</strong>); doubled in PvP, reduced by DR; additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Demonsbane</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Demons and Fire Beasts, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Desperation</h3>
            <ul>
              <li>Base damage bonus: <strong>2%</strong> per perk.</li>
              <li>Additional scaling: up to <strong>[6/8/10]%</strong> bonus damage based on missing health.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Destruction</h3>
            <p>Increases damage dealt by <strong>[4/5/6]</strong>%.</p>
          </section>
          <section class="stat-card">
            <h3>Epidemic</h3>
            <ul>
              <li><strong>[6/8/10]%</strong> bonus disease damage, additive.</li>
              <li><strong>[4/6/8]%</strong> bonus disease chance, additive.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Executioner</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Humanoids and Giants, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Garrote</h3>
            <p>This perk only works if you have <strong>100 base Strength</strong>.</p>
            <ul>
              <li>Increases Bleed Chance by <strong>[4/5/6]%</strong>.</li>
              <li>Increases Bleed Damage by <strong>[2.5/3.0/3.5]%</strong>.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Hawkeye</h3>
            <ul>
              <li>Increases To-Hit by <strong>[8/10/12]</strong>.</li>
              <li>Increases Crit Chance by <strong>[3/4/5]%</strong>.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Iceshatter</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Ice Beasts, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Immunization</h3>
            <p><strong>[20/25/30]%</strong> chance to avoid disease, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Impenetrable</h3>
            <p>Increases Armor by <strong>[4/5/6]</strong>.</p>
          </section>
          <section class="stat-card">
            <h3>Juggernaut</h3>
            <p>
              <strong>20%</strong> chance to reduce damage taken by <strong>[25/30/35]%</strong>, multiplicative.
            </p>
          </section>
          <section class="stat-card">
            <h3>Knowledge</h3>
            <p><strong>[10/12.5/15]%</strong> increase to experience gained, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Lethal Toxins</h3>
            <ul>
              <li><strong>[6/8/10]%</strong> bonus poison damage, additive.</li>
              <li><strong>[4/6/8]%</strong> bonus poison chance, additive.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Lifesteal</h3>
            <p>Steals <strong>[6/8/10]%</strong> of your damage in PvP; half effectiveness in PvE.</p>
          </section>
          <section class="stat-card">
            <h3>Magic Shield</h3>
            <p>Increases all resistances by <strong>[2/3/4]%</strong>.</p>
          </section>
          <section class="stat-card">
            <h3>Moneybags</h3>
            <p>Monsters drop an additional <strong>[20/25/30]%</strong> gold.</p>
          </section>
          <section class="stat-card">
            <h3>Overpower</h3>
            <ul>
              <li>Increases Crit Damage by <strong>[5/6/7]%</strong>.</li>
              <li>Increases Crit Chance by <strong>[3/4/5]%</strong>.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Parry</h3>
            <p>
              <strong>(6/7/9/10)%</strong> chance (based on weapon speed) to parry, reducing damage taken by
              <strong>[70/80/90]%</strong>, multiplicative.
            </p>
          </section>
          <section class="stat-card">
            <h3>Rejuvenation</h3>
            <p>
              Heals an additional <strong>[10/15/20]</strong> per Constitution tick, plus
              <strong>[2/3/4]</strong> per tick for every 25 player levels; additive.
            </p>
          </section>
          <section class="stat-card">
            <span id="perk-resistances"></span>
            <h3>Demon Blood</h3>
            <p>
              Increases <span style="color: var(--resist-fire)">Fire</span> resistance by <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Frozen Heart</h3>
            <p>
              Increases <span style="color: var(--resist-cold)">Cold</span> resistance by <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Lightning Field</h3>
            <p>
              Increases <span style="color: var(--resist-electric)">Lightning</span> resistance by
              <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Tourniquet</h3>
            <p>
              Increases <span style="color: var(--resist-poison)">Poison</span> resistance by <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Hazmat</h3>
            <p>
              Increases <span style="color: var(--resist-disease)">Disease</span> resistance by
              <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Antacid</h3>
            <p>
              Increases <span style="color: var(--resist-acid)">Acid</span> resistance by <strong>[8/10/12]%</strong>.
            </p>
          </section>
          <section class="stat-card">
            <h3>Swiftness</h3>
            <p>
              <strong>(2/3/3/4)%</strong> chance on attack to grant +20% Dexterity for 60 seconds plus
              <strong>[15/30/45]</strong> bonus seconds; additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Tenacity</h3>
            <p>
              <strong>(2/3/3/4)%</strong> chance when attacked to grant +20% Constitution for 60 seconds plus
              <strong>[15/30/45]</strong> bonus seconds; additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Toxic Shell</h3>
            <p>
              On poison attack, generates an Overshield for <strong>[10/15/20]%</strong> of the damage your poison
              deals; doubled in PvP, reduced by DR; additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Vampirism</h3>
            <p>
              <strong>(8/10/11/13)%</strong> chance to trigger a HoT that heals every 5 seconds for 5 ticks:
            </p>
            <ul>
              <li><strong>PvP:</strong> <strong>[3/3.75/4.5]%</strong> of target max health.</li>
              <li><strong>PvE:</strong> <strong>[1/1.5/2]%</strong> of target max health (capped at 4000).</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Venomshock</h3>
            <p><strong>[11/13/15]%</strong> bonus damage against Electric and Poison Beasts, additive.</p>
          </section>
          <section class="stat-card">
            <h3>Vitality</h3>
            <p>Increases player health by <strong>[200/250/300]</strong>.</p>
          </section>

          </div>
        </article>

        <article class="content-section" id="unique-effects">
          <h2>Unique Perks (Typically Item-Only)</h2>
          <div class="stat-grid perk-grid">
          <section class="stat-card">
            <h3>Blood Siphon</h3>
            <p>
              When you cause bleed, gain a HoT equal to <strong>[33/66/100]%</strong> of your bleed damage;
              half effectiveness in PvE.
            </p>
          </section>
          <section class="stat-card">
            <h3>Crimson Feast</h3>
            <p>
              When you disease a target, gain a HoT equal to <strong>[33/66/100]%</strong> of your disease damage;
              halved in PvE.
            </p>
          </section>
          <section class="stat-card">
            <h3>Envenomation</h3>
            <ul>
              <li>Allows poisons regardless of weapon element.</li>
              <li>+<strong>[5/10/15]%</strong> poison chance, additive.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Flame Buffet</h3>
            <p>
              <strong>(15/20/25/30)%</strong> chance to inflict a DoT dealing
              <strong>[50–100 / 100–200 / 200–300]</strong> damage per tick.
            </p>
          </section>
          <section class="stat-card">
            <h3>Lycan</h3>
            <ul>
              <li>Allows diseases regardless of weapon element.</li>
              <li>+<strong>[5/10/15]%</strong> disease chance, additive.</li>
            </ul>
          </section>
          <section class="stat-card">
            <h3>Plague Eater</h3>
            <p>
              Chance equal to your offensive disease chance to reflect disease on attackers, dealing
              <strong>[5/10/15]%</strong> of damage taken per tick; additive.
            </p>
          </section>
          <section class="stat-card">
            <h3>Runic</h3>
            <p>
              Steals <strong>[10/12.5/15]%</strong> of your damage in PvE or
              <strong>[20/25/30]%</strong> of your damage in PvP.
            </p>
          </section>
          <section class="stat-card">
            <h3>Vengeance</h3>
            <p>
              <strong>{Con/3}%</strong> chance to deal an additional
              <strong>[0.2–0.25 Con / 0.25–0.33 Con / 0.33–0.5 Con]</strong> Constitution damage; additive.
            </p>
          </section>

          </div>
        </article>
      </main>
    </div>

    <script>
      (() => {
        const perkJump = document.getElementById("perk-jump");
        let highlightedCard = null;

        const getPreferredScrollBehavior = () => {
          try {
            return window.matchMedia("(prefers-reduced-motion: reduce)").matches ? "auto" : "smooth";
          } catch (error) {
            return "smooth";
          }
        };

        const getPerkSlug = (name) => {
          if (!name) return "";
          const slug = String(name)
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/^-+|-+$/g, "");
          return slug ? `perk-${slug}` : "";
        };

        const fetchPerksIndex = async () => {
          try {
            const url = new URL("pages/systems/perks.json", document.baseURI).toString();
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to load perks.json");
            return await response.json();
          } catch (error) {
            console.warn(error.message || error);
            return null;
          }
        };

        const highlightCard = (node) => {
          const card = node ? node.closest?.(".stat-card") || node : null;
          if (!card) return;

          if (highlightedCard && highlightedCard !== card) {
            highlightedCard.classList.remove("perk-jump-target");
          }

          highlightedCard = card;
          card.classList.add("perk-jump-target");
        };

        const jumpToSlug = (slug, { updateHistory = false } = {}) => {
          const targetSlug = (slug || "").replace(/^#/, "");
          if (!targetSlug) return;
          const target = document.getElementById(targetSlug);
          if (!target) return;
          target.scrollIntoView({ behavior: getPreferredScrollBehavior(), block: "start" });
          highlightCard(target);
          if (updateHistory) {
            try {
              history.replaceState(null, "", `#${targetSlug}`);
            } catch (error) {
              /* noop */
            }
          }
        };

        const bindCardIds = (perks) => {
          const cards = Array.from(document.querySelectorAll("#perk-list .stat-card, #unique-effects .stat-card"));
          if (!cards.length) return;

          const byName = new Map();
          perks.forEach((entry) => {
            if (!entry || typeof entry.name !== "string") return;
            byName.set(entry.name.trim().toLowerCase(), entry);
          });

          cards.forEach((card) => {
            const name = card.querySelector("h3")?.textContent?.trim() || "";
            if (!name) return;
            const entry = byName.get(name.toLowerCase());
            const slug = entry?.slug || getPerkSlug(name);
            if (slug) card.id = slug;
            card.setAttribute("data-perk-name", name);
          });
        };

        const populatePerkJump = (perks) => {
          if (!perkJump) return;

          const normal = perks
            .filter((entry) => entry && typeof entry.name === "string")
            .filter((entry) => entry.isUnique !== true)
            .map((entry) => ({
              name: entry.name.trim(),
              slug: entry.slug || getPerkSlug(entry.name),
              group: entry.group ? String(entry.group).trim() : "",
            }))
            .filter((entry) => entry.name && entry.slug);

          const unique = perks
            .filter((entry) => entry && typeof entry.name === "string")
            .filter((entry) => entry.isUnique === true)
            .map((entry) => ({ name: entry.name.trim(), slug: entry.slug || getPerkSlug(entry.name) }))
            .filter((entry) => entry.name && entry.slug);

          const grouped = new Map();
          const ungrouped = [];
          normal.forEach((entry) => {
            if (entry.group) {
              const items = grouped.get(entry.group) || [];
              items.push(entry);
              grouped.set(entry.group, items);
              return;
            }
            ungrouped.push(entry);
          });
          ungrouped.sort((a, b) => a.name.localeCompare(b.name));
          unique.sort((a, b) => a.name.localeCompare(b.name));

          perkJump.innerHTML = "";
          const placeholder = document.createElement("option");
          placeholder.value = "";
          placeholder.textContent = "Jump to…";
          perkJump.appendChild(placeholder);

          const appendGroup = (label, items) => {
            if (!items.length) return;
            const group = document.createElement("optgroup");
            group.label = label;
            items.forEach((item) => {
              const opt = document.createElement("option");
              opt.value = item.slug;
              opt.textContent = item.name;
              group.appendChild(opt);
            });
            perkJump.appendChild(group);
          };

          appendGroup("Perks", ungrouped);
          grouped.forEach((items, label) => appendGroup(label, items));
          appendGroup("Unique Perks", unique);

          perkJump.addEventListener("change", () => {
            const slug = perkJump.value || "";
            if (!slug) return;
            jumpToSlug(slug, { updateHistory: true });
          });
        };

        document.addEventListener("DOMContentLoaded", async () => {
          const index = await fetchPerksIndex();
          const perks = Array.isArray(index?.perks) ? index.perks : [];
          if (!perks.length) {
            if (perkJump) {
              perkJump.innerHTML = '<option value="">Perks unavailable</option>';
            }
            return;
          }
          bindCardIds(perks);
          populatePerkJump(perks);

          if (window.location.hash) {
            jumpToSlug(window.location.hash, { updateHistory: false });
          }

          window.addEventListener("hashchange", () => {
            if (!window.location.hash) return;
            jumpToSlug(window.location.hash, { updateHistory: false });
          });
        });
      })();
    </script>
  </body>
</html>
