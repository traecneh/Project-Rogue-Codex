<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Resistances â€” Project Rogue Codex</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<base href="../../"/>
<link href="images/project-rogue-favicon.ico" rel="icon" type="image/x-icon"/>
<link href="images/project-rogue-favicon-32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="images/project-rogue-favicon-64.png" rel="icon" sizes="64x64" type="image/png"/>
<link href="images/project-rogue-favicon-180.png" rel="icon" sizes="180x180" type="image/png"/>
<link href="images/project-rogue-favicon-512.png" rel="icon" sizes="512x512" type="image/png"/>
<link href="css/styles.css" rel="stylesheet"/>
<script defer="" src="js/nav-loader.js"></script>
<style>
  .element-label {
    font-weight: 700;
    letter-spacing: 0.02em;
  }

  #monster-resistances ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }

  #monster-resistances li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    column-gap: 0.5rem;
  }

  #monster-resistances .resist-divider {
    width: 100%;
    margin: 0.25rem 0;
    border: none;
    border-top: 1px solid var(--border-soft);
    opacity: 0.5;
  }
</style>
</head>
<body>
<div class="layout">
<div id="sidebar-root"></div>
<main class="main-content">
<header class="content-header">
<h1 class="content-title">Resistances</h1>
<p class="content-tagline">Elemental damage reductions for players and monsters.</p>
</header>
<article class="content-section" id="player-resistances">
<h2>Players</h2>
<p>
            Player resistances to <strong>Fire, Electric, Poison, Cold, Acid,</strong> and <strong>Disease</strong> are
            flat damage reductions capped at <strong>60%</strong>; excess over cap is ignored for that element.
          </p>
<div class="stat-grid" role="list">
            <section class="stat-card" role="listitem">
              <p class="stat-label">Per Element</p>
              <h3>Independent Caps</h3>
              <p>Each element tracks separately; only the capped element ignores excess.</p>
            </section>
            <section class="stat-card" role="listitem">
              <p class="stat-label">Stacking</p>
              <h3>Additive Sources</h3>
              <p>Sources stack additively unless a perk specifies multiplicative.</p>
            </section>
            <section class="stat-card" role="listitem">
              <p class="stat-label">Order</p>
              <h3>Damage Step</h3>
              <p>Applied after armor, before reactive perks and on-hit effects.</p>
            </section>
          </div>
</article>
<article class="content-section" id="monster-resistances">
<h2>Monster Resistances</h2>
<p>Values above <strong class="resist-value" data-resist-value="1.00">1.00x</strong> mean increased damage taken; below means reduced.</p>
<div class="stat-grid">
            <section class="stat-card">
              <div class="stat-label">Humanoid</div>
              <img
                data-monster-type="humanoid"
                alt="Humanoid example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Poison: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
                <li>Disease: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
<li>Acid: <strong class="resist-value" data-resist-value="1.15">1.15x</strong></li>
<hr class="resist-divider"/><li>Fire: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Cold: <strong class="resist-value" data-resist-value="0.90">0.90x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Giant</div>
              <img
                data-monster-type="giant"
                alt="Giant example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Electric: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
                <li>Cold: <strong class="resist-value" data-resist-value="1.15">1.15x</strong></li>
<hr class="resist-divider"/><li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Fire: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
<li>Acid: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Animal</div>
              <img
                data-monster-type="animal"
                alt="Animal example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Poison: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
                <li>Disease: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
<li>Fire: <strong class="resist-value" data-resist-value="1.10">1.10x</strong></li>
<hr class="resist-divider"/><li>Cold: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Acid: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Beast</div>
              <img
                data-monster-type="beast"
                alt="Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Cold: <strong class="resist-value" data-resist-value="1.10">1.10x</strong></li>
                <li>Acid: <strong class="resist-value" data-resist-value="1.10">1.10x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.10">1.10x</strong></li>
<hr class="resist-divider"/><li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Fire: <strong class="resist-value" data-resist-value="0.90">0.90x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Undead</div>
              <img
                data-monster-type="undead"
                alt="Undead example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Fire: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
                <li>Electric: <strong class="resist-value" data-resist-value="1.15">1.15x</strong></li>
<hr class="resist-divider"/><li>Cold: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Acid: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Demon</div>
              <img
                data-monster-type="demon"
                alt="Demon example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Cold: <strong class="resist-value" data-resist-value="1.30">1.30x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="1.15">1.15x</strong></li>
<hr class="resist-divider"/><li>Acid: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Fire: <strong class="resist-value" data-resist-value="0.70">0.70x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Fire Beast</div>
              <img
                data-monster-type="fire beast"
                alt="Fire Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
                <li>Cold: <strong class="resist-value" data-resist-value="1.30">1.30x</strong></li>
                <hr class="resist-divider" />
                <li>Electric: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
                <li>Acid: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
                <li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
                <li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
                <hr class="resist-divider" />
                <li>Fire: <strong class="resist-value" data-resist-value="0.70">0.70x</strong></li>
              </ul>
            </section>
            <section class="stat-card">
              <div class="stat-label">Ice Beast</div>
              <img
                data-monster-type="ice beast"
                alt="Ice Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
<li>Fire: <strong class="resist-value" data-resist-value="1.30">1.30x</strong></li>
<li>Acid: <strong class="resist-value" data-resist-value="1.20">1.20x</strong></li>
<hr class="resist-divider"/><li>Electric: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Cold: <strong class="resist-value" data-resist-value="0.70">0.70x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Electric Beast</div>
              <img
                data-monster-type="electric beast"
                alt="Electric Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
<li>Acid: <strong class="resist-value" data-resist-value="1.30">1.30x</strong></li>
<li>Cold: <strong class="resist-value" data-resist-value="1.15">1.15x</strong></li>
<hr class="resist-divider"/><li>Fire: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Electric: <strong class="resist-value" data-resist-value="0.70">0.70x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Poison Beast</div>
              <img
                data-monster-type="poison beast"
                alt="Poison Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
<li>Acid: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
<li>Fire: <strong class="resist-value" data-resist-value="1.20">1.20x</strong></li>
<hr class="resist-divider"/><li>Cold: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Disease: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Poison: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
</ul>
</section>
            <section class="stat-card">
              <div class="stat-label">Disease Beast</div>
              <img
                data-monster-type="disease beast"
                alt="Disease Beast example"
                width="32"
                height="32"
                class="resistance-icon"
              />
              <ul>
<li>Fire: <strong class="resist-value" data-resist-value="1.25">1.25x</strong></li>
<li>Electric: <strong class="resist-value" data-resist-value="1.10">1.10x</strong></li>
<hr class="resist-divider"/><li>Cold: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Acid: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li>
<li>Poison: <strong class="resist-value" data-resist-value="1.00">1.00x</strong></li><hr class="resist-divider"/>
<li>Disease: <strong class="resist-value" data-resist-value="0.80">0.80x</strong></li>
</ul>
</section>
</div>
</article>
</main>
</div>
<script>
  (function () {
    const ELEMENT_COLORS = {
      fire: "#ff5a5a",
      electric: "#b86bff",
      poison: "#2f7a2f",
      cold: "#7cc9ff",
      acid: "#b38b00",
      disease: "#ff9c42",
    };

    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".resist-value").forEach((node) => {
        const raw = node.getAttribute("data-resist-value") || node.textContent;
        const value = parseFloat(raw);
        if (Number.isNaN(value)) return;
        node.textContent = formatResistanceValue(value);
        node.style.color = getResistanceColor(value);
      });

      const listItems = document.querySelectorAll("#monster-resistances li");
      listItems.forEach((li) => {
        const strong = li.querySelector("strong");
        if (!strong) return;
        const rawText = (li.textContent || "").split(":")[0] || "";
        const elementName = rawText.trim();
        if (!elementName) return;
        const valueClone = strong.cloneNode(true);
        const label = document.createElement("span");
        label.className = "element-label";
        label.textContent = elementName;
        const color = ELEMENT_COLORS[elementName.toLowerCase()];
        if (color) label.style.color = color;

        li.innerHTML = "";
        li.appendChild(label);
        li.appendChild(valueClone);
      });
    });

    function getResistanceColor(value) {
      if (value > 1) {
        const ratio = Math.min((value - 1) / 0.3, 1);
        const lightness = 50 + 20 * ratio;
        const saturation = 65 + 15 * ratio;
        return `hsl(120, ${saturation}%, ${lightness}%)`;
      }
      if (value < 1) {
        const ratio = Math.min((1 - value) / 0.3, 1);
        const lightness = 55 + 25 * ratio;
        return `hsl(0, 80%, ${lightness}%)`;
      }
      return "#bbbbbb";
    }

    function formatResistanceValue(value) {
      if (Number.isInteger(value)) return `${value}x`;
      let text = value.toString();
      if (text.startsWith("0.")) {
        text = text.replace(/^0+/, "");
      } else if (text.startsWith("-0.")) {
        text = text.replace(/^-0+/, "-.");
      }
      text = text.replace(/(\.\d*?)0+$/, "$1"); // trim trailing zeros
      if (text.endsWith(".")) text = text.slice(0, -1);
      return `${text}x`;
    }

    (function hydrateResistanceIcons() {
      const icons = Array.from(document.querySelectorAll(".resistance-icon"));
      if (!icons.length) return;

      const dataUrl = new URL("../enemies/monsters.json", window.location.href);
      const TYPE_ALIAS = {
        electricalbeast: "electric beast",
        "electrical beast": "electric beast",
        firebeast: "fire beast",
        icebeast: "ice beast",
        poisonbeast: "poison beast",
        diseasebeast: "disease beast",
      };

      const normalizeType = (value) => {
        if (!value) return "";
        const spaced = value
          .replace(/([a-z])([A-Z])/g, "$1 $2")
          .replace(/[_]+/g, " ")
          .trim()
          .toLowerCase();
        return TYPE_ALIAS[spaced] || spaced;
      };

      const deriveImageCandidates = (monster) => {
        const candidates = [];
        const rawName = (monster && monster.name) || "";
        const spacedName = rawName.replace(/\s+/g, " ").trim();
        const safeName = spacedName.replace(/[\\/:*?"<>|]/g, "");

        if (monster && monster.image) {
          candidates.push(monster.image);
        }

        if (safeName) {
          const encoded = encodeURI(`images/monsters/${safeName}`);
          candidates.push(`${encoded}.gif`, `${encoded}.GIF`, `${encoded}.png`, `${encoded}.PNG`);
        }

        return Array.from(new Set(candidates.filter(Boolean)));
      };

      const setImageSource = (imgEl, monster) => {
        const sources = deriveImageCandidates(monster);
        if (!sources.length) {
          imgEl.removeAttribute("src");
          imgEl.alt = "No image";
          return;
        }
        let index = 0;
        const trySet = () => {
          imgEl.onerror = () => {
            index += 1;
            if (index < sources.length) {
              trySet();
            } else {
              imgEl.onerror = null;
              imgEl.removeAttribute("src");
              imgEl.alt = "No image";
            }
          };
          imgEl.onload = () => {
            imgEl.onload = null;
          };
          imgEl.src = sources[index];
        };
        trySet();
      };

      fetch(dataUrl.toString())
        .then((res) => (res.ok ? res.json() : Promise.reject()))
        .then((data) => {
          if (!Array.isArray(data)) return;
          const byType = data.reduce((acc, monster) => {
            const key = normalizeType(monster.monsterType);
            if (!key) return acc;
            if (!acc[key]) acc[key] = [];
            acc[key].push(monster);
            return acc;
          }, {});

          icons.forEach((img) => {
            const explicit = img.getAttribute("data-monster-type") || "";
            const label = (img.closest(".stat-card")?.querySelector(".stat-label")?.textContent || "").trim();
            const key = normalizeType(explicit || label);
            const pool = byType[key] || [];
            const pick = pool.length ? pool[Math.floor(Math.random() * pool.length)] : null;
            if (pick) {
              img.alt = pick.name ? `${pick.name} example` : `${label} example`;
              setImageSource(img, pick);
            } else {
              img.removeAttribute("src");
              img.alt = "No matching monster";
            }
          });
        })
        .catch(() => {
          // swallow errors; fallback icons remain blank
        });
    })();
  })();
</script>
</body>
</html>
