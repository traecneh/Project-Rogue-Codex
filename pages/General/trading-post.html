<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Trading Post &mdash; Project Rogue Codex</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link rel="icon" type="image/x-icon" href="images/project-rogue-favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/project-rogue-favicon-32.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="images/project-rogue-favicon-64.png" />
    <link rel="icon" type="image/png" sizes="180x180" href="images/project-rogue-favicon-180.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="images/project-rogue-favicon-512.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/nav-loader.js" defer></script>
    <script src="js/trading-post.js" defer></script>
    <style>
      .trading-post .content-title {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .content-title .badge {
        font-size: 0.7rem;
        letter-spacing: 0.08em;
      }

      .trading-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 0.8rem;
        margin-top: 0.6rem;
      }

      .trading-overview .trade-pill {
        border: 1px solid var(--border-soft);
        border-radius: 8px;
        padding: 0.8rem 1rem;
        background: linear-gradient(135deg, rgba(50, 60, 75, 0.85), rgba(16, 20, 27, 0.9));
        box-shadow: 0 0 0 1px #0b0f16, 0 6px 14px rgba(0, 0, 0, 0.55);
      }

      .trading-overview h3 {
        margin: 0 0 0.35rem;
        font-size: 1rem;
        color: var(--accent-blue);
      }

      .trading-overview p {
        margin: 0;
        color: var(--text-muted);
        line-height: 1.5;
      }

      .trading-layout {
        display: grid;
        grid-template-columns: 1.1fr 0.9fr;
        gap: 1rem;
        align-items: start;
        margin-top: 1rem;
      }

      .trade-panel {
        border: 1px solid var(--border-soft);
        border-radius: 10px;
        padding: 1rem 1.1rem;
        background: radial-gradient(circle at top left, #232a36, #10141b 70%);
        box-shadow: 0 0 0 1px #0b0f16, 0 10px 18px rgba(0, 0, 0, 0.6);
      }

      .trade-panel header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 0.6rem;
      }

      .trade-panel h3 {
        margin: 0;
        font-size: 1.05rem;
      }

      .auth-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
        min-width: 240px;
      }

      .auth-status {
        padding: 0.35rem 0.6rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .auth-status[data-variant="success"] {
        border-color: rgba(75, 255, 75, 0.4);
        color: #c6f6c9;
        box-shadow: 0 0 10px rgba(75, 255, 75, 0.14);
      }

      .panel-subtitle {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.92rem;
      }

      .listing-form {
        display: grid;
        gap: 0.65rem;
      }

      .field {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .field label {
        font-size: 0.9rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--text-muted);
      }

      .text-input,
      .select-input,
      .notes-input {
        width: 100%;
        padding: 0.55rem 0.75rem;
        border-radius: 6px;
        border: 1px solid var(--border-soft);
        background: var(--bg-panel-dark);
        color: var(--text-main);
        font-size: 0.95rem;
      }

      .notes-input {
        min-height: 90px;
        resize: vertical;
      }

      .input-row {
        display: flex;
        gap: 0.65rem;
        flex-wrap: wrap;
      }

      .input-row .field {
        flex: 1 1 200px;
      }

      .listing-type {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
      }

      .type-chip {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.75rem;
        border-radius: 999px;
        border: 1px solid var(--border-soft);
        background: #141821;
        cursor: pointer;
        user-select: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease, transform 0.08s ease;
      }

      .type-chip input {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .type-chip[data-active="true"] {
        border-color: var(--accent);
        box-shadow: 0 0 10px rgba(75, 255, 75, 0.22);
        transform: translateY(-1px);
      }

      .type-chip .tag {
        font-weight: 700;
        letter-spacing: 0.08em;
      }

      .action-row {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        flex-wrap: wrap;
        margin-top: 0.3rem;
      }

      .primary-btn,
      .ghost-btn {
        border-radius: 8px;
        padding: 0.55rem 1rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        cursor: pointer;
        border: 1px solid var(--border-soft);
        background: linear-gradient(135deg, rgba(75, 255, 75, 0.18), rgba(75, 255, 75, 0.08));
        color: #ffffff;
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.4);
        transition: transform 0.1s ease, box-shadow 0.15s ease, border-color 0.15s ease;
      }

      .primary-btn:hover {
        border-color: var(--accent);
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.55);
      }

      .ghost-btn {
        background: #11151d;
        color: var(--text-muted);
      }

      .ghost-btn.ghost-danger {
        border-color: rgba(255, 126, 126, 0.6);
        color: #ffc9c9;
      }

      .ghost-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .item-preview {
        border: 1px dashed rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 0.75rem 0.9rem;
        background: rgba(0, 0, 0, 0.25);
        min-height: 120px;
      }

      .item-preview .preview-header {
        display: flex;
        align-items: center;
        gap: 0.65rem;
      }

      .item-avatar {
        width: 48px;
        height: 48px;
        border-radius: 6px;
        border: 1px solid var(--border-soft);
        background: #0f1218;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
      }

      .item-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .item-avatar-fallback {
        width: 100%;
        height: 100%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        font-weight: 700;
        letter-spacing: 0.08em;
        background: rgba(255, 255, 255, 0.04);
      }

      .item-preview h4 {
        margin: 0 0 0.25rem;
        font-size: 1rem;
      }

      .item-preview p {
        margin: 0.1rem 0;
        color: var(--text-muted);
      }

      .item-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
        margin-top: 0.35rem;
      }

      .item-chip {
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        font-size: 0.82rem;
      }

      .filter-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.65rem;
        align-items: center;
        margin-bottom: 0.6rem;
      }

      .filter-bar .text-input {
        max-width: 360px;
      }

      .filter-select {
        padding: 0.45rem 0.6rem;
        border-radius: 6px;
        border: 1px solid var(--border-soft);
        background: var(--bg-panel-dark);
        color: var(--text-main);
        min-width: 140px;
      }

      .listings-panel {
        display: grid;
        gap: 0.6rem;
      }

      .listing-count {
        font-size: 0.92rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 0.4rem;
      }

      .listing-feed {
        display: grid;
        gap: 0.75rem;
      }

      .listing-card {
        border: 1px solid var(--border-soft);
        border-radius: 10px;
        padding: 0.75rem 0.9rem;
        background: linear-gradient(135deg, rgba(40, 46, 58, 0.9), rgba(14, 18, 26, 0.95));
        box-shadow: 0 0 0 1px #0b0f16, 0 8px 14px rgba(0, 0, 0, 0.55);
      }

      .listing-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .listing-title {
        display: flex;
        align-items: center;
        gap: 0.55rem;
        flex-wrap: wrap;
      }

      .listing-title h4 {
        margin: 0;
        font-size: 1rem;
      }

      .tag-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        font-size: 0.78rem;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      .tag-pill.wts {
        background: rgba(75, 255, 75, 0.14);
        border-color: rgba(75, 255, 75, 0.5);
        color: #c8ffc8;
      }

      .tag-pill.wtb {
        background: rgba(90, 176, 255, 0.14);
        border-color: rgba(90, 176, 255, 0.6);
        color: #c7e3ff;
      }

      .tag-pill.wtt {
        background: rgba(255, 214, 90, 0.14);
        border-color: rgba(255, 214, 90, 0.6);
        color: #ffe9b5;
      }

      .listing-body {
        margin-top: 0.35rem;
        color: var(--text-muted);
        display: grid;
        gap: 0.15rem;
      }

      .listing-meta {
        display: flex;
        gap: 0.35rem;
        flex-wrap: wrap;
        margin-top: 0.3rem;
      }

      .meta-pill {
        padding: 0.18rem 0.5rem;
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        font-size: 0.82rem;
        color: var(--text-main);
      }

      .empty-state {
        border: 1px dashed rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        color: var(--text-muted);
        background: rgba(0, 0, 0, 0.2);
      }

      .status-message {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .status-message[data-variant="success"] {
        color: #c6f6c9;
      }

      .status-message[data-variant="error"] {
        color: #ffc9c9;
      }

      .discord-placeholder {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.65rem 0.75rem;
        border-radius: 8px;
        border: 1px dashed rgba(255, 255, 255, 0.2);
        background: rgba(0, 0, 0, 0.25);
      }

      .roadmap-list {
        margin: 0.2rem 0 0;
        padding-left: 1rem;
        color: var(--text-muted);
      }

      @media (max-width: 960px) {
        .trading-layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <div id="sidebar-root"></div>
      <main class="main-content trading-post">
        <header class="content-header">
          <h1 class="content-title">
            Trading Post
            <span class="badge"><span class="badge-dot"></span> Prototype</span>
          </h1>
          <p class="content-tagline">
            Post, search, and refine community listings without leaving the Codex.
          </p>
        </header>

        <article class="content-section" id="trading-overview">
          <h2>Marketplace Snapshot</h2>
          <p>
            All interactions are client-side for now; data loads from the existing item JSON and stays in memory until
            you refresh. Filters and previews are designed to swap to a real backend later.
          </p>
          <div class="trading-overview">
            <div class="trade-pill">
              <h3>Live Filters</h3>
              <p>Search by name, listing type, or item category. Updates instantly against your current in-memory board.</p>
            </div>
            <div class="trade-pill">
              <h3>Item-Aware Form</h3>
              <p>Selector is powered by <code>weapons.json</code> + <code>armor.json</code> (future) so only valid gear can be listed.</p>
            </div>
            <div class="trade-pill">
              <h3>Discord Sign-in</h3>
              <p>Uses Discord identify (implicit grant) with tokens kept client-side. Future: persistence, expiration dates, and price tracking.</p>
            </div>
          </div>
        </article>

        <article class="content-section" id="trading-workbench">
          <div class="trading-layout">
            <section class="trade-panel">
              <header>
                <div>
                  <h3>Create Listing</h3>
                  <p class="panel-subtitle">Pick a valid item, set your intent, and post it under your Discord profile.</p>
                </div>
                <div class="auth-controls">
                  <div class="auth-status" id="auth-status">Not signed in</div>
                  <button class="ghost-btn" type="button" id="discord-login">Sign in with Discord</button>
                  <button class="ghost-btn ghost-danger" type="button" id="discord-logout" hidden>Sign out</button>
                </div>
              </header>

              <form id="listing-form" class="listing-form" autocomplete="off">
                <div class="field">
                  <label for="item-select">Item</label>
                  <select id="item-select" name="item" class="select-input" required>
                    <option value="">Loading items...</option>
                  </select>
                  <div class="item-preview" id="item-preview">
                    <p id="item-preview-empty">Select an item to see its basics.</p>
                  </div>
                </div>

                <div class="field">
                  <label>Listing Type</label>
                  <div class="listing-type" id="listing-type">
                    <label class="type-chip" data-type="WTS">
                      <input type="radio" name="listingType" value="WTS" checked />
                      <span class="tag">WTS</span>
                      <span>Want to Sell</span>
                    </label>
                    <label class="type-chip" data-type="WTB">
                      <input type="radio" name="listingType" value="WTB" />
                      <span class="tag">WTB</span>
                      <span>Want to Buy</span>
                    </label>
                    <label class="type-chip" data-type="WTT">
                      <input type="radio" name="listingType" value="WTT" />
                      <span class="tag">WTT</span>
                      <span>Want to Trade</span>
                    </label>
                  </div>
                </div>

                <div class="input-row">
                  <div class="field">
                    <label for="price-input">Price</label>
                    <input id="price-input" name="price" class="text-input" type="text" placeholder="1200g, offer, etc." />
                  </div>
                </div>

                <div class="input-row">
                  <div class="field">
                    <label for="ign-input">In-game Name (optional)</label>
                    <input id="ign-input" name="ign" class="text-input" type="text" placeholder="Character name" />
                  </div>
                  <div class="field">
                    <label for="notes-input">Notes</label>
                    <textarea id="notes-input" name="notes" class="notes-input" placeholder="Timing, trade prefs, etc."></textarea>
                  </div>
                </div>

                <div class="action-row">
                  <button type="submit" class="primary-btn">Post Listing</button>
                  <p class="status-message" id="form-status" role="status" aria-live="polite"></p>
                </div>
              </form>
            </section>

            <section class="trade-panel">
              <header>
                <div>
                  <h3>Item Summary &amp; Roadmap</h3>
                  <p class="panel-subtitle">Quick facts update as you pick an item.</p>
                </div>
              </header>
              <div class="item-preview" id="preview-card">
                <p id="preview-placeholder">Choose an item to inspect level, subtype, and rarity.</p>
              </div>
              <div class="discord-placeholder" aria-live="polite">
                <strong>Account linking</strong>
                <span>Now uses Discord identify (implicit grant). Future: persist listings per Discord ID when a backend is added.</span>
              </div>
              <div class="roadmap">
                <h4>Expansion Hooks</h4>
                <ul class="roadmap-list">
                  <li>Expiration dates to auto-trim stale posts.</li>
                  <li>Price history and trend notes per item.</li>
                  <li>Per-item stats for faster sorting.</li>
                </ul>
              </div>
            </section>
          </div>
        </article>

        <article class="content-section" id="trading-board">
          <h2>Active Listings</h2>
          <div class="trade-panel listings-panel">
            <div class="filter-bar">
              <input
                id="filter-search"
                class="text-input"
                type="search"
                placeholder="Search by item name..."
                aria-label="Search listings by item name"
              />
              <select id="filter-type" class="filter-select" aria-label="Filter by listing type">
                <option value="all">All types</option>
                <option value="WTS">WTS</option>
                <option value="WTB">WTB</option>
                <option value="WTT">WTT</option>
              </select>
              <select id="filter-category" class="filter-select" aria-label="Filter by item category">
                <option value="all">All items</option>
                <option value="Weapon">Weapon</option>
                <option value="Armor">Armor</option>
              </select>
            </div>
            <div class="listing-count" id="listing-count" aria-live="polite">Loading listings...</div>
            <div class="listing-feed" id="listing-feed"></div>
          </div>
        </article>
      </main>
    </div>
  </body>
</html>
